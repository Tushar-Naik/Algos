package com.flipkart.programs;

import java.util.HashMap;

public class LRUCache<K,V> {

	/**
	 * Linkedlist + Hashmap
	 */
	private Node<V, K> head, tail ;
	private HashMap<K,Node<V>> map = new HashMap<K,Node<V>>();
	private static final int CAPACTITY = 3;
	private int currentSize = 0;
	
	private static class Node<V>{
		Node<V> next;
		Node<V> prev;
		V val;
		K key;
		public Node(Node<V> prev, Node<V> next, V val, K key) {
			this.prev = prev;
			this.next = next;
			this.val = val;
			this.key = key;
		}
		public V getVal() {
			return val;
		}
		@Override
		public String toString() {
			return val.toString();
		}
	}
	
	public void put(K key, V val){
		Node<V> node = addToLinkedList(val);
		map.put(key, node);
		
	}
	
	private Node<V> addToLinkedList(V val) {
		if (head==null){
			Node<V> newNode = new Node<V>(null, null, val) ;
			head = newNode; tail = newNode;
			currentSize++;
			
		}else {
			//Capacity check delete the oldest
			if(currentSize==CAPACTITY){
				Node<V> tmp = tail;
				map.remove(tail);
				tail.next.prev = null;
				tail = tail.next;
				tmp = null; currentSize--;
			}
			Node<V> newNode = new Node<V>(head, null, val ) ;
			head.next = newNode;
			head = newNode;
			currentSize++;
		}
		return head;
	}

	public V get(K key){
		Node<V> node = map.get(key);
		Node<V> prev = node.prev;
		Node<V> next = node.next;
		prev.next = next;
		next.prev = prev;
		node.next = null;
		node.prev = head;
		head = node;
		return map.get(key).getVal();
	}
	
	
	public static void main(String[] args) {
		LRUCache<Integer, String> lruCache = new LRUCache<Integer, String>();
		lruCache.put(1,"A");
		lruCache.put(2,"B");
		lruCache.put(3,"C");
		lruCache.put(4,"D");
	}

}
